AY232K (izzx)
Обмен ZX <> PC
Версия программы AY232 для карты ZX WiFi и других, при наличии драйверов (некоторые есть в комплекте).
Позволяет по WiFi скачивать или загружать на сервер файлы.

Включена поддержка HDD (SMUCv2, SMUCv1, NemoStd, NemoA8, ATMide, PROFIide, ZC, DivMMC) с драйверами от LW.
Копирует файлы FAT32 с короткими именами.
Напрямую копировать между TRD и FAT пока не умеет.
Размер каталога FAT32 - первые 128 файлов.
Умеет: 
пофайлово копировать с дискеты TRD в образ TRD на сервере и обратно,
целиком TRD с дискеты на сервер и обратно,
пофайлово с раздела FAT32 на сервер и обратно.

Адрес сервера и порт считываются из файла конфигурации.
Сервер поддерживает максимальный размер файла 65 Мбайт.
Если файл был, он перезаписывается без предупреждения!

Тема программы AY232 (которая изначально для подключения через AY) на форуме:
https://zx-pk.ru/threads/33584-snova-o-podklyuchenii-zx-pc.html?p=1136995&viewfull=1#post1136995
Железка ZX WiFi:
https://zx-pk.ru/threads/33138-opros-wifi-dlya-zx-klonov-ne-na-fpga.html?s=6469cd0c6ef497d858df3bb441daeb09

Минимальные требования:
Клиент: ZX 48k + BDI или DivMMC, карта ZX WiFi (или другое устройство на ESP)
Сервер: Windows, Linux + wine
Точка доступа WiFi.

Проверено на:
Scorpion GMX (и в режиме Pentagon тоже)
Scorpion 256 Turbo+
Spectrum +2A + DivMMC
Evolution
Сервер:
Win 7 32/64 + NET Framework 4.8
Astra Linux CE 2.12.46.6
Карта:
ESP-12E, прошивка AT1.1.0.0, 1.7.4.0

Порядок работы:
1. Запустить exe файл сервера в папке с файлами (образами TRD).
 (параметром можно назначить порт, по умолчанию 8888)
2. Включить ZX с установленной и настроенной картой
3. Поправить имя сервера в файле "AY232K_i.C". Можно с помощью zxword. 
Там же можно выключить поддержку контроллеров HDD, если возникают проблемы.
4. Запустить клиента с диска AY232K.TRD

После запуска клиент получает каталог сервера.
Остановить - пробел.
В левой панели можно сразу запустить *.B файл кнопкой Enter.
В правой панели можно раскрыть образ TRD и копировать по файлам.
Подгрузка следующей страницы каталога - курсор вниз или вверх.

Диск TRD и файлы FAT32 копируются пакетами по 1024 байта (быстрее), а файлы TRD по 256 байт (медленнее).

Первоначальная настройка ESP 12E с заводской прошивкой выполняется утилитой NetMan.
После включения ESP будет сама подключаться к точке доступа.

Как собрать клиента (если понадобится): 
1. Поправить имя сервера в "AY232K_i.C"
2. Возможно, если сервер не успевает, в файле "zx-wifi.asm" увеличить задержку "retry_rec_count_max equ 3".
3. Запустить сборку файлом "_Build_Trdos.bat".
4. Взять готовый файл AY232K.TRD

Если нужно сменить драйвер, то в файле AY232K.asm поправить строчку
include "drivers/zx-wifi.asm"

Запуск сервера в Astra Linux CE.
В менеджере пакетов Synaptic добавить пакет playonlinux (с ним поставится wine и прочие пакеты).
Скопировать exe и trd файлы в отдельную папку и запустить из терминала Fly:
wine ZXNServerK.exe
На предложение поставить пакет "wine-mono" согласиться.

Если сервер не видит клиента, проверьте такие настройки как:
На роутере:
Изоляция клиентов
На компьютере: 
Брандмауэр
Уровень сигнала WiFi. Должен быть достаточно хорошим.


Общие сведения, реализованы частично

Порядок приёма файла с сервера:
1. Сервер на PC заранее включен. Запускается из того каталога, который будет общим.
2. ZX (клиент) посылает запрос на каталог, 32 байта
3. Сервер отправляет пакет размером заголовок 32 + 1024 байт  (инфа о 64 файлах по 16 байт)   + 2 байта контрольная сумма
4. При выборе файла клиент посылает запрос на приём 
    Сервер отправляет файл частями по 1024 + заголовок + контрольная сумма.
    Клиент посылает запрос на каждую часть отдельно, указывая смещение от начала файла.
5. Если контрольная сумма не сошлась, клиент посылает запрос снова
6. Если пакет успешно принят, он записывается на диск.
7. Запрос следующей части

При передаче файла на сервер:
1. Клиент посылает пакет с частью файла, 32+1024+2 байт
2. Сервер проверяет контрольную сумму, 
 записывает часть файла, и посылает подтверждение, 32 байта
 Если файла не было, он создаётся. Если был, перезаписывается.
3. Если клиент получает пакет с кодом ошибки, то посылает запрос снова
4. Отправка следующей части

Формат обмена PC-ZX

Формат заголовка,  32 байта:

0-2 буквы ZXN
3 Тип пакета (см. ниже)
4-5 Смещение от начала файла (какая часть, по 256 или 1024 байт)
6-11 Не используется
12-15 Длина файла
16-28 Имя файла
29-31 Не используется

32-1055 Данные
1056-57 Контрольная сумма пакета (простое сложение всех байт пакета вместе с заголовком)

Формат каталога:
0-11 Имя файла
12-15 Длина файла

Тип пакета:
0 - Запрос каталога (части в 1024 байт)
1 - Каталог (1024 байт)
2 - Запрос на приём файла (1024)
3 - Файл (1024)
4 - Запрос на передачу файла (1024)
5 - Файл принят (1024)
6 - Запрос на приём файла (256)
7 - Файл (256)
8 - Запрос на передачу файла (256)
9 - Файл принят (256)
255 - Ошибка
